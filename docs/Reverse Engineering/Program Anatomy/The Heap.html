<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js coal">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Heap - The Cyberclopaedia</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="This is an aspiring project aimed at accumulating knowledge from the world of cybersecurity and presenting it in a cogent way, so it is accessible to as large and audience as possible and so that everyone has a good resource to learn hacking from.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <meta property="og:title" content="The Heap" />
        <meta property="og:image" content="http://cr0mll.github.io/cyberclopaedia/favicon.png" />
        <meta property="og:image:secure_url" content="https://cr0mll.github.io/cyberclopaedia/favicon.png" />
        <meta property="og:description" content="The Cyberclopaedia is an aspiring project aimed at accumulating knowledge from the world of cybersecurity and presenting it in a cogent way, so it is accessible to as large an audience as possible and so that everyone has a good resource to learn hacking from." />

        <meta property="twitter:card" content="summary" />
        <meta property="twitter:site" content="@cr0mll" />
        <meta property="twitter:creator" content="@cr0mll" />
        <meta property="twitter:title" content="The Heap" />
        <meta property="twitter:description" content="The Cyberclopaedia is an aspiring project aimed at accumulating knowledge from the world of cybersecurity and presenting it in a cogent way, so that everyone can learn." />
        <meta property="twitter:image" content="https://cr0mll.github.io/cyberclopaedia/favicon.png" />
        <meta property="twitter:image:alt" content="Cyberclopaedia Logo" />
        

        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../.././mdbook-admonish.css">

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "coal";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('coal')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <div class="sidebar-scrollbox">
                <img style="max-width:100%;
max-height:100%;" src="../../favicon.png" > <!-- Icon pls -->
                <ol class="chapter"><li class="chapter-item "><a href="../../Cyberclopaedia/index.html">Cyberclopaedia</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Cyberclopaedia/Contributing.html">Contributing</a></li><li class="chapter-item "><a href="../../Cyberclopaedia/License.html">License</a></li></ol></li><li class="chapter-item "><a href="../../Reconnaissance/index.html">Reconnaissance</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Reconnaissance/Enumeration/index.html">Enumeration</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Reconnaissance/Enumeration/nmap/index.html">nmap</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Reconnaissance/Enumeration/nmap/TCP SYN & TCP Connect scans.html">TCP SYN & TCP Connect scans</a></li><li class="chapter-item "><a href="../../Reconnaissance/Enumeration/nmap/FIN, NULL & XMAS Scans.html">FIN, NULL & XMAS Scans</a></li></ol></li><li class="chapter-item "><a href="../../Reconnaissance/Enumeration/DNS Server Enumeration (53).html">DNS Server Enumeration (53)</a></li><li class="chapter-item "><a href="../../Reconnaissance/Enumeration/FTP Enumeration (21).html">FTP Enumeration (21)</a></li><li class="chapter-item "><a href="../../Reconnaissance/Enumeration/SNMP Enumeration (161).html">SNMP Enumeration (161)</a></li><li class="chapter-item "><a href="../../Reconnaissance/Enumeration/LDAP Enumeration (389, 636, 3268, 3269).html">LDAP Enumeration (389, 636, 3268, 3269)</a></li></ol></li><li class="chapter-item "><a href="../../Reconnaissance/OSINT/index.html">OSINT</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Reconnaissance/OSINT/Tools/index.html">Tools</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Reconnaissance/OSINT/Tools/theHarvester.html">theHarvester</a></li><li class="chapter-item "><a href="../../Reconnaissance/OSINT/Tools/recon-ng.html">recon-ng</a></li></ol></li><li class="chapter-item "><a href="../../Reconnaissance/OSINT/Domain Name Enumeration.html">Domain Name Enumeration</a></li><li class="chapter-item "><a href="../../Reconnaissance/OSINT/Harvesting E-Mails.html">Harvesting E-Mails</a></li><li class="chapter-item "><a href="../../Reconnaissance/OSINT/Instagram User Enumeration.html">Instagram User Enumeration</a></li><li class="chapter-item "><a href="../../Reconnaissance/OSINT/Google Dorks.html">Google Dorks</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../Exploitation/index.html">Exploitation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Exploitation/Binary Exploitation/index.html">Binary Exploitation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Exploitation/Binary Exploitation/Heap Exploitation/index.html">Heap Exploitation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Exploitation/Binary Exploitation/Heap Exploitation/Use After Free (UAF).html">Use After Free (UAF)</a></li></ol></li><li class="chapter-item "><a href="../../Exploitation/Binary Exploitation/Stack Exploitation/index.html">Stack Exploitation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Exploitation/Binary Exploitation/Stack Exploitation/Format String Vulnerabilities.html">Format String Vulnerabilities</a></li><li class="chapter-item "><a href="../../Exploitation/Binary Exploitation/Stack Exploitation/Protection Mechanisms.html">Protection Mechanisms</a></li><li class="chapter-item "><a href="../../Exploitation/Binary Exploitation/Stack Exploitation/Return to _dl_resolve.html">Return to _dl_resolve</a></li><li class="chapter-item "><a href="../../Exploitation/Binary Exploitation/Stack Exploitation/Return-oriented programming (ROP).html">Return-oriented programming (ROP)</a></li><li class="chapter-item "><a href="../../Exploitation/Binary Exploitation/Stack Exploitation/Sigreturn-oriented Programming (SROP).html">Sigreturn-oriented Programming (SROP)</a></li><li class="chapter-item "><a href="../../Exploitation/Binary Exploitation/Stack Exploitation/Buffer Overflows.html">Buffer Overflows</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../Exploitation/Web/index.html">Web</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Exploitation/Web/SQL Injection/index.html">SQL Injection</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Exploitation/Web/SQL Injection/Finding SQLi.html">Finding SQLi</a></li><li class="chapter-item "><a href="../../Exploitation/Web/SQL Injection/Defences.html">Defences</a></li><li class="chapter-item "><a href="../../Exploitation/Web/SQL Injection/Introduction.html">Introduction</a></li><li class="chapter-item "><a href="../../Exploitation/Web/SQL Injection/Union injections.html">Union injections</a></li><li class="chapter-item "><a href="../../Exploitation/Web/SQL Injection/Cheatsheets.html">Cheatsheets</a></li></ol></li><li class="chapter-item "><a href="../../Exploitation/Web/Template Injection.html">Template Injection</a></li><li class="chapter-item "><a href="../../Exploitation/Web/Open Redirect.html">Open Redirect</a></li><li class="chapter-item "><a href="../../Exploitation/Web/PHP Object Injection.html">PHP Object Injection</a></li><li class="chapter-item "><a href="../../Exploitation/Web/HTTP Response Splitting.html">HTTP Response Splitting</a></li><li class="chapter-item "><a href="../../Exploitation/Web/CRLF Injection.html">CRLF Injection</a></li><li class="chapter-item "><a href="../../Exploitation/Web/Cross-Site Scripting (XSS).html">Cross-Site Scripting (XSS)</a></li><li class="chapter-item "><a href="../../Exploitation/Web/Cross-Site Request Forgery.html">Cross-Site Request Forgery</a></li><li class="chapter-item "><a href="../../Exploitation/Web/WebSockets.html">WebSockets</a></li><li class="chapter-item "><a href="../../Exploitation/Web/HTTP Parameter Pollution.html">HTTP Parameter Pollution</a></li><li class="chapter-item "><a href="../../Exploitation/Web/Host Header Injection.html">Host Header Injection</a></li></ol></li><li class="chapter-item "><a href="../../Exploitation/Windows/index.html">Windows</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Exploitation/Windows/SCF File Attacks.html">SCF File Attacks</a></li></ol></li><li class="chapter-item "><a href="../../Exploitation/DNS/index.html">DNS</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Exploitation/DNS/DNS Traffic Amplification.html">DNS Traffic Amplification</a></li><li class="chapter-item "><a href="../../Exploitation/DNS/DNS Cache Poisoning.html">DNS Cache Poisoning</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../Post Exploitation/index.html">Post Exploitation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/index.html">Privilege Escalation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Linux/index.html">Linux</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Linux/Abusing SUID & SGID Binaries.html">Abusing SUID & SGID Binaries</a></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Linux/Kernel Exploits.html">Kernel Exploits</a></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Linux/Sudo Shell Escape Sequences.html">Sudo Shell Escape Sequences</a></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Linux/NFS Root Squashing.html">NFS Root Squashing</a></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Linux/Abusing Linux Capabilities.html">Abusing Linux Capabilities</a></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Linux/Sudo Escalation via LD_PRELOAD.html">Sudo Escalation via LD_PRELOAD</a></li></ol></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Windows/index.html">Windows</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Windows/Misconfigured Services/index.html">Misconfigured Services</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Windows/Misconfigured Services/Unquoted Service Paths.html">Unquoted Service Paths</a></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Windows/Misconfigured Services/Weak Registry Permissions.html">Weak Registry Permissions</a></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Windows/Misconfigured Services/Insecure Service Permissions.html">Insecure Service Permissions</a></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Windows/Misconfigured Services/Insecure Service Executable Permissions.html">Insecure Service Executable Permissions</a></li></ol></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Windows/AutoRun Programmes.html">AutoRun Programmes</a></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Windows/AlwaysInstallElevated Group Policy.html">AlwaysInstallElevated Group Policy</a></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Windows/Kernel Exploits.html">Kernel Exploits</a></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Windows/Scheduled Tasks.html">Scheduled Tasks</a></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Windows/Bypassing UAC.html">Bypassing UAC</a></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Windows/Startup Applications.html">Startup Applications</a></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Windows/Stored Credentials.html">Stored Credentials</a></li><li class="chapter-item "><a href="../../Post Exploitation/Privilege Escalation/Windows/Token Impersonation.html">Token Impersonation</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../Post Exploitation/Enumeration/index.html">Enumeration</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Post Exploitation/Enumeration/Linux/index.html">Linux</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Post Exploitation/Enumeration/Linux/Hunting Down Sensitive Files.html">Hunting Down Sensitive Files</a></li><li class="chapter-item "><a href="../../Post Exploitation/Enumeration/Linux/System Enumeration.html">System Enumeration</a></li><li class="chapter-item "><a href="../../Post Exploitation/Enumeration/Linux/User Enumeration.html">User Enumeration</a></li><li class="chapter-item "><a href="../../Post Exploitation/Enumeration/Linux/Network Enumeration.html">Network Enumeration</a></li></ol></li><li class="chapter-item "><a href="../../Post Exploitation/Enumeration/Windows/index.html">Windows</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Post Exploitation/Enumeration/Windows/System Enumeration.html">System Enumeration</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../Post Exploitation/Pivoting/index.html">Pivoting</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Post Exploitation/Pivoting/Tunneling with Chisel.html">Tunneling with Chisel</a></li><li class="chapter-item "><a href="../../Post Exploitation/Pivoting/SSH Tunneling.html">SSH Tunneling</a></li></ol></li><li class="chapter-item "><a href="../../Post Exploitation/Active Directory (AD)/index.html">Active Directory (AD)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Post Exploitation/Active Directory (AD)/Domain Enumeration with PowerView.html">Domain Enumeration with PowerView</a></li><li class="chapter-item "><a href="../../Post Exploitation/Active Directory (AD)/Domain Data Enumeration with Bloodhound.html">Domain Data Enumeration with Bloodhound</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../System Internals/index.html">System Internals</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../System Internals/Linux/index.html">Linux</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../System Internals/Linux/Processes.html">Processes</a></li><li class="chapter-item "><a href="../../System Internals/Linux/File System.html">File System</a></li><li class="chapter-item "><a href="../../System Internals/Linux/Command Line.html">Command Line</a></li></ol></li><li class="chapter-item "><a href="../../System Internals/Windows/index.html">Windows</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../System Internals/Windows/Active Directory (AD)/index.html">Active Directory (AD)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../System Internals/Windows/Active Directory (AD)/Contacts.html">Contacts</a></li><li class="chapter-item "><a href="../../System Internals/Windows/Active Directory (AD)/Terminology.html">Terminology</a></li><li class="chapter-item "><a href="../../System Internals/Windows/Active Directory (AD)/Users.html">Users</a></li><li class="chapter-item "><a href="../../System Internals/Windows/Active Directory (AD)/Groups.html">Groups</a></li><li class="chapter-item "><a href="../../System Internals/Windows/Active Directory (AD)/Domain Controllers.html">Domain Controllers</a></li><li class="chapter-item "><a href="../../System Internals/Windows/Active Directory (AD)/Computers.html">Computers</a></li></ol></li><li class="chapter-item "><a href="../../System Internals/Windows/File System.html">File System</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../Reverse Engineering/index.html">Reverse Engineering</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Reverse Engineering/Program Anatomy/index.html">Program Anatomy</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Reverse Engineering/Program Anatomy/The Stack.html">The Stack</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Program Anatomy/Instructions.html">Instructions</a></li><li class="chapter-item expanded "><a href="../../Reverse Engineering/Program Anatomy/The Heap.html" class="active">The Heap</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Program Anatomy/Registers.html">Registers</a></li></ol></li><li class="chapter-item "><a href="../../Reverse Engineering/Reverse Engineering with Ghidra/index.html">Reverse Engineering with Ghidra</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Reverse Engineering/Reverse Engineering with Ghidra/Creating a Project and Loading a Binary.html">Creating a Project and Loading a Binary</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Reverse Engineering with Ghidra/Initial Analysis.html">Initial Analysis</a></li></ol></li><li class="chapter-item "><a href="../../Reverse Engineering/Reverse Engineering with radare2/index.html">Reverse Engineering with radare2</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Reverse Engineering/Reverse Engineering with radare2/Analysis.html">Analysis</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Reverse Engineering with radare2/Strings.html">Strings</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Reverse Engineering with radare2/Binary Info.html">Binary Info</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Reverse Engineering with radare2/Flags.html">Flags</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Reverse Engineering with radare2/Seeking.html">Seeking</a></li></ol></li><li class="chapter-item "><a href="../../Reverse Engineering/Assembly Programming/index.html">Assembly Programming</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Reverse Engineering/Assembly Programming/x86-64/index.html">x86-64</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Reverse Engineering/Assembly Programming/x86-64/Variables.html">Variables</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Assembly Programming/x86-64/Data Representation.html">Data Representation</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Assembly Programming/x86-64/Addressing Modes.html">Addressing Modes</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Assembly Programming/x86-64/Memory.html">Memory</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Assembly Programming/x86-64/Registers.html">Registers</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Assembly Programming/x86-64/Instruction Set.html">Instruction Set</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/index.html">Binary Formats</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/PE/index.html">PE</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/PE/Relocations.html">Relocations</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/PE/NT Headers.html">NT Headers</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/PE/Sections.html">Sections</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/PE/The Rich Header.html">The Rich Header</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/PE/The DOS Header.html">The DOS Header</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/PE/The DOS Stub.html">The DOS Stub</a></li></ol></li><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/ELF/index.html">ELF</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/ELF/Symbols.html">Symbols</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/ELF/Relocations.html">Relocations</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/ELF/Sections.html">Sections</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/ELF/Segments.html">Segments</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/ELF/The ELF Header.html">The ELF Header</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/ELF/Dynamic Linking.html">Dynamic Linking</a></li></ol></li><li class="chapter-item "><a href="../../Reverse Engineering/Binary Formats/Reverse Engineering Android Applications.html">Reverse Engineering Android Applications</a></li></ol></li><li class="chapter-item "><a href="../../Reverse Engineering/Assembly.html">Assembly</a></li><li class="chapter-item "><a href="../../Reverse Engineering/Basic Reverse Engineering using objdump, strace, and ltrace.html">Basic Reverse Engineering using objdump, strace, and ltrace</a></li></ol></li><li class="chapter-item "><a href="../../Hardware Hacking/index.html">Hardware Hacking</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Hardware Hacking/Wireless Attacks/index.html">Wireless Attacks</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Hardware Hacking/Wireless Attacks/Hacking WPA Networks.html">Hacking WPA Networks</a></li><li class="chapter-item "><a href="../../Hardware Hacking/Wireless Attacks/Deauth Attack.html">Deauth Attack</a></li><li class="chapter-item "><a href="../../Hardware Hacking/Wireless Attacks/Hacking WEP Networks.html">Hacking WEP Networks</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../Cryptography/index.html">Cryptography</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Cryptography/Hash Functions/index.html">Hash Functions</a></li><li class="chapter-item "><a href="../../Cryptography/Public-Key Cryptography/index.html">Public-Key Cryptography</a></li><li class="chapter-item "><a href="../../Cryptography/Pseudorandom Generators (PRGs)/index.html">Pseudorandom Generators (PRGs)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Cryptography/Pseudorandom Generators (PRGs)/Pseudorandom Functions (PRFs).html">Pseudorandom Functions (PRFs)</a></li></ol></li><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/index.html">Private-Key Cryptography</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/Stream Ciphers/index.html">Stream Ciphers</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/Stream Ciphers/Hardware-Oriented Stream Ciphers/index.html">Hardware-Oriented Stream Ciphers</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/Stream Ciphers/Hardware-Oriented Stream Ciphers/Grain-128a.html">Grain-128a</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/Block Ciphers/index.html">Block Ciphers</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/Block Ciphers/CBC Bit Flip Attack.html">CBC Bit Flip Attack</a></li><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/Block Ciphers/Advanced Encryption Standard (AES).html">Advanced Encryption Standard (AES)</a></li><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/Block Ciphers/Padding Oracle Attack.html">Padding Oracle Attack</a></li><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/Block Ciphers/Encrypting Non-Conforming Messages.html">Encrypting Non-Conforming Messages</a></li><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/Block Ciphers/Modes of Operation.html">Modes of Operation</a></li></ol></li><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/Security Notions/index.html">Security Notions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/Security Notions/Perfect Secrecy.html">Perfect Secrecy</a></li><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/Security Notions/Semantic Security.html">Semantic Security</a></li><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/Security Notions/Randomness.html">Randomness</a></li><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/Security Notions/P vs NP.html">P vs NP</a></li></ol></li><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/One-Time Pad.html">One-Time Pad</a></li><li class="chapter-item "><a href="../../Cryptography/Private-Key Cryptography/Message Authentication Codes (MACs).html">Message Authentication Codes (MACs)</a></li></ol></li><li class="chapter-item "><a href="../../Cryptography/Breaking Classical Cryptrography.html">Breaking Classical Cryptrography</a></li><li class="chapter-item "><a href="../../Cryptography/Mathematical Prerequisites.html">Mathematical Prerequisites</a></li><li class="chapter-item "><a href="../../Cryptography/Computer Science Prerequisites.html">Computer Science Prerequisites</a></li></ol></li><li class="chapter-item "><a href="../../Networking/index.html">Networking</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Networking/Protocols/index.html">Protocols</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Networking/Protocols/Internet Protocol (IP)/index.html">Internet Protocol (IP)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Networking/Protocols/Internet Protocol (IP)/Internet Protocol v4 (IPv4)/index.html">Internet Protocol v4 (IPv4)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Networking/Protocols/Internet Protocol (IP)/Internet Protocol v4 (IPv4)/Subnetting.html">Subnetting</a></li><li class="chapter-item "><a href="../../Networking/Protocols/Internet Protocol (IP)/Internet Protocol v4 (IPv4)/Classful Addressing.html">Classful Addressing</a></li><li class="chapter-item "><a href="../../Networking/Protocols/Internet Protocol (IP)/Internet Protocol v4 (IPv4)/Classless Inter-Domain Routing (CIDR).html">Classless Inter-Domain Routing (CIDR)</a></li><li class="chapter-item "><a href="../../Networking/Protocols/Internet Protocol (IP)/Internet Protocol v4 (IPv4)/IPv4 Datagrams.html">IPv4 Datagrams</a></li></ol></li><li class="chapter-item "><a href="../../Networking/Protocols/Internet Protocol (IP)/Internet Protocol v6 (IPv6).html">Internet Protocol v6 (IPv6)</a></li></ol></li><li class="chapter-item "><a href="../../Networking/Protocols/WLAN (IEEE 802.11)/index.html">WLAN (IEEE 802.11)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Networking/Protocols/WLAN (IEEE 802.11)/Management Frames/index.html">Management Frames</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Networking/Protocols/WLAN (IEEE 802.11)/Management Frames/Action Frames.html">Action Frames</a></li><li class="chapter-item "><a href="../../Networking/Protocols/WLAN (IEEE 802.11)/Management Frames/Association Frames.html">Association Frames</a></li><li class="chapter-item "><a href="../../Networking/Protocols/WLAN (IEEE 802.11)/Management Frames/Authentication Frames.html">Authentication Frames</a></li><li class="chapter-item "><a href="../../Networking/Protocols/WLAN (IEEE 802.11)/Management Frames/Discovery Frames.html">Discovery Frames</a></li></ol></li><li class="chapter-item "><a href="../../Networking/Protocols/WLAN (IEEE 802.11)/Data Frames.html">Data Frames</a></li><li class="chapter-item "><a href="../../Networking/Protocols/WLAN (IEEE 802.11)/Control Frames.html">Control Frames</a></li><li class="chapter-item "><a href="../../Networking/Protocols/WLAN (IEEE 802.11)/Authentication & Association.html">Authentication & Association</a></li><li class="chapter-item "><a href="../../Networking/Protocols/WLAN (IEEE 802.11)/WiFi Protected Access (WPA).html">WiFi Protected Access (WPA)</a></li><li class="chapter-item "><a href="../../Networking/Protocols/WLAN (IEEE 802.11)/Encryption & Integrity.html">Encryption & Integrity</a></li></ol></li><li class="chapter-item "><a href="../../Networking/Protocols/Domain Name System (DNS)/index.html">Domain Name System (DNS)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Networking/Protocols/Domain Name System (DNS)/The in-addr.arpa Domain.html">The in-addr.arpa Domain</a></li><li class="chapter-item "><a href="../../Networking/Protocols/Domain Name System (DNS)/The Domain Name System.html">The Domain Name System</a></li><li class="chapter-item "><a href="../../Networking/Protocols/Domain Name System (DNS)/DNS Protocol.html">DNS Protocol</a></li></ol></li><li class="chapter-item "><a href="../../Networking/Protocols/Simple Network Management Protocol (SNMP).html">Simple Network Management Protocol (SNMP)</a></li><li class="chapter-item "><a href="../../Networking/Protocols/Leightweight Directory Access Protocol (LDAP).html">Leightweight Directory Access Protocol (LDAP)</a></li><li class="chapter-item "><a href="../../Networking/Protocols/Server Message Block (SMB).html">Server Message Block (SMB)</a></li><li class="chapter-item "><a href="../../Networking/Protocols/Network Time Protocol (NTP).html">Network Time Protocol (NTP)</a></li><li class="chapter-item "><a href="../../Networking/Protocols/File Transfer Protocol (FTP).html">File Transfer Protocol (FTP)</a></li><li class="chapter-item "><a href="../../Networking/Protocols/Address Resolution Protocol (ARP).html">Address Resolution Protocol (ARP)</a></li><li class="chapter-item "><a href="../../Networking/Protocols/Ethernet (IEEE 802.3).html">Ethernet (IEEE 802.3)</a></li></ol></li><li class="chapter-item "><a href="../../Networking/Networks/index.html">Networks</a></li><li class="chapter-item "><a href="../../Networking/The TCP-IP Suite and the OSI Model/index.html">The TCP-IP Suite and the OSI Model</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../Networking/The TCP-IP Suite and the OSI Model/(1) The Physical Layer.html">(1) The Physical Layer</a></li><li class="chapter-item "><a href="../../Networking/The TCP-IP Suite and the OSI Model/(2) The Datalink Layer.html">(2) The Datalink Layer</a></li></ol></li><li class="chapter-item "><a href="../../Networking/Network Address Translation (NAT).html">Network Address Translation (NAT)</a></li><li class="chapter-item "><a href="../../Networking/Subnetting.html">Subnetting</a></li><li class="chapter-item "><a href="../../Networking/VLANs.html">VLANs</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Cyberclopaedia</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/cr0mll/cyberclopaedia/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="the-heap"><a class="header" href="#the-heap">The Heap</a></h1>
<p>The heap is a memory region which allows for dynamic allocation. Memory on the heap is allotted at runtime and programs are permitted to freely request additional heap memory whenever it is required.</p>
<p>It is the program's job to request and relieve any heap memory <em>only once</em>. Failure to do so can result in undefined behaviour. In C, heap memory is usually allocated through the use of <code>malloc</code> and whenever the program is finished with this data, the <code>free</code> function must be invoked in order to mark the area as available for use by the operating system and/or other programs.</p>
<p>Heap memory can also be allocated by using malloc-compatible heap functions like <code>calloc</code>, <code>realloc</code> and <code>memalign</code> or in C++ using the corresponding <code>new</code> and <code>new[]</code> operators as well as their deallocation counterparts <code>delete</code> and <code>delete[]</code>.</p>
<h2 id="heap-rules"><a class="header" href="#heap-rules">Heap Rules</a></h2>
<ol>
<li><em>Do not</em> read or write to a pointer returned by <code>malloc</code> after that pointer has been passed to <code>free</code>. -&gt; Can lead to use after free vulnerabilities. </li>
<li><em>Do not</em> use or leak uninitialised information in a heap allocation. -&gt; Can lead to information leaks or uninitialised data vulnerabilities.</li>
<li><em>Do not</em> read or write bytes after the end of an allocation. -&gt; Can lead to heap overflow and read beyond bounds vulnerabilities.</li>
<li><em>Do not</em> pass a pointer that originated from <code>malloc</code> to <code>free</code> more than once. -&gt; Can lead to double delete vulnerabilities.</li>
<li><em>Do not</em> write bytes before the beginning of the allocation. -&gt; Can lead to heap underflow vulnerabilities.</li>
<li><em>Do not</em> pass a pointer that did not originate from <code>malloc</code> to <code>free</code>.  -&gt; Can lead to invalid free vulnerabilities.</li>
<li><em>Do not</em> use a pointer returned by <code>malloc</code> before checking if the function returned <code>NULL</code>. -&gt; Can lead to null-dereference bugs and sometimes arbitrary write vulnerabilities.</li>
</ol>
<p>The implementation of the heap is platform specific.</p>
<h1 id="the-glibc-heap"><a class="header" href="#the-glibc-heap">The GLIBC Heap</a></h1>
<p>The heap grows from lower to higher addresses. </p>
<h2 id="chunks"><a class="header" href="#chunks">Chunks</a></h2>
<p>The heap manager allocates resources in the so-called <em>chunks</em>. These chunks are stored adjacent to each other and must be 8-byte aligned or 16-byte aligned on 32-bit and 64-bit systems respectively. In addition to this padding, each chunks contains metadata which provides information about the chunk itself. Consequently, issuing a request for memory allocation on the heap actually allocates more bytes than originally requested.</p>
<p>It is important to distinguish between in-use chunks and free (or previously allocated) chunks, since they have disparate memory layouts.</p>
<p>The following diagram outlines a chunk that is in use:</p>
<p><img src="Resources/Images/In_use_chunk.png" alt="" /></p>
<p>The <code>size</code> field contains the chunk size in bytes. The following three bits carry specific meaning:</p>
<ul>
<li><strong>A (0x04)</strong> - Allocated arena. If this bit is 0, the chunk comes from the main arena and the main heap. If this bit is 1, the chunk comes from mmap'd memory and the location of the heap can be computed from the chunk's address.</li>
<li><strong>M (0x02)</strong> - If this bit is set, then the chunk was <code>mmap</code>-ed and isn't part of a heap. Typically used for large allocations.</li>
<li><strong>P (0x01)</strong> - If this bit is set, then the previous chunk should not be considered for coalescing and the <code>mchunkptr</code> points to a previous chunk still in use</li>
</ul>
<p>A free chunk looks a bit different:</p>
<p><img src="Resources/Images/Free_chunk.png" alt="" /></p>
<p>The size and AMP fields carry on the same meaning as those in chunks that are in use. Free chunks are organised in linked or doubly linked lists called <em>bins</em>. The <code>fwd</code> and <code>bck</code> pointers are utilised in the implementation of those linked lists. Different types of bins exist for different purposes.</p>
<p>The top of the heap is by convention called <em>the top chunk</em>.</p>
<h2 id="memory-allocation-on-the-heap"><a class="header" href="#memory-allocation-on-the-heap">Memory Allocation on the Heap</a></h2>
<h3 id="allocating-from-free-chunks"><a class="header" href="#allocating-from-free-chunks">Allocating from Free Chunks</a></h3>
<p>When an application requests heap memory, the heap manager traverses the bins in search of a free chunk that is large enough to service the request. If such a chunk is found, it is removed from the bin, turned into an in-use chunk and then a pointer is returned to the user data section of the chunk.</p>
<h3 id="allocating-from-the-top-chunk"><a class="header" href="#allocating-from-the-top-chunk">Allocating from the Top Chunk</a></h3>
<p>If no free chunk is found that can service the request, the heap manager must construct an entirely new chunk at the top of heap. To achieve this, it first needs to ascertain whether there is enough space at the top of the heap to hold the new chunk.</p>
<h3 id="requesting-additional-memory-at-the-top-of-the-heap-from-the-kernel"><a class="header" href="#requesting-additional-memory-at-the-top-of-the-heap-from-the-kernel">Requesting Additional Memory at the Top of the Heap from the Kernel</a></h3>
<p>Once the free space at the top of the heap is used up, the heap manager will have to ask the kernel for additional memory.</p>
<p>On the initial heap, the heap manager asks the kernel to allocate more memory at the end of the heap by calling <code>sbrk</code>.On most Linux-based systems this function internally uses a system call called <code>brk</code>. </p>
<p>Eventuall, the heap will grow to its maximum size, since expanding it any further would cause it to intrude on other sections of the process' address space. In this case, the heap manager will resort to using <code>mmap</code> to map new memory for heap expansions.</p>
<p>If <code>mmap</code> also fails, then the process is unable to allocate more memory and <code>malloc</code> returns <code>NULL</code>.</p>
<h3 id="allocating-large-chunks"><a class="header" href="#allocating-large-chunks">Allocating Large Chunks</a></h3>
<p>Large chunks get treated differently in their allocation. These are allocated off-heap through the direct use of <code>mmap</code> calls and this is reflected in the chunk's metadata by setting the <code>M</code> bit to 1. When such allocations are later returned to the heap manager via a call to <code>free</code>, the heap manager releases the entire <code>mmap</code>-ed region back to the system via <code>munmap</code>.</p>
<p>Different platforms have different default thresholds for what counts as a large chunk and what doesn't.</p>
<h2 id="arenas"><a class="header" href="#arenas">Arenas</a></h2>
<p>Multithreaded applications require that internal data structures on the heap are protected from race conditions. In the past, the heap manager availed itself of a global mutex before every heap operation, however, significant performance issues arose as a result. Consequently, the concept of &quot;arenas&quot; was introduced. </p>
<p>Each arena consists of a separate heap which manages its own chunk allocation and bins. Although each arena still utilises a mutex for its internal operations, different threads can make use of different arenas to avoid having to wait for each other. </p>
<p>The initial (main) arena consists of a single heap and for single-threaded applications it is all there ever will exist. However, as more threads are spawned, new arenas are allocated and attached to them. Once all available arenas are being utilised by threads, the heap manager will commence creating new ones until a limit - <code>2 * Number of CPU cores</code> for 32-bit and <code>8 * Number of CPU cores</code> for 64-bit processes - is reached. Afterwards, multiple threads will be forced to share the same arena.</p>
<h2 id="bins"><a class="header" href="#bins">Bins</a></h2>
<p>Free chunks are organised in the so-called <em>bins</em> which are essentially linked lists. For performance reasons different types of bins exist. There are 62 <strong>small bins,</strong> 63 <strong>large bins,</strong> 1 <strong>unsorted bin,</strong> 10 <strong>fast bins</strong> and 64 <strong>tcache bins</strong> per thread. The last two appeared later and are built on top of the first three.</p>
<p>Pointers to the small, large, and unsorted bins are stored in the same array in the heap manager:</p>
<pre><code class="language-cpp">BIN[0] -&gt; invalid (unused)
BIN[1] -&gt; unsorted bin
BIN[2] to BIN[63] -&gt; small bins
BIN[64] to BIN[126] -&gt; large bins
</code></pre>
<h3 id="small-bins"><a class="header" href="#small-bins">Small Bins</a></h3>
<p>There are 62 small bins and each of them stores chunks of a fixed size. Each chunk with a size less than 512 bytes on 32-bit systems and 1024 bytes on 64-bit systems has a corresponding small bin. Small bins are sorted by default due to the fixed size of their elements and Insertion and removal of entries on these bins is incredibly fast.</p>
<p><img src="Resources/Images/Small%20Bin.png" alt="" /></p>
<h3 id="large-bins"><a class="header" href="#large-bins">Large Bins</a></h3>
<p>There are 63 large bins and they resemble small bins in their operation but store chunks of different sizes. Consequently, insertions and removal of entries on these lists is slower, since the entire bin has to be traversed in order to find a suitable chunk. </p>
<p>There is a different number of bins allocated for specific chunk size ranges. The size of the chunk size range begins at 64 bytes - there are 32 bins all of which shift the range of chunk sizes they store by 64 from the previous bin. Following are 16 bins which shift the range by 512 bytes and so on.</p>
<p>In essence:</p>
<ul>
<li>Bin 1 -&gt; stores chunks of sizes 512 - 568 bytes;</li>
<li>Bin 2 -&gt; stores chunks of sizes 576 - 632 bytes;</li>
<li>...</li>
</ul>
<p>There are:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">Number of Bins</th><th style="text-align: center">Spacing between Bins</th></tr></thead><tbody>
<tr><td style="text-align: center">32</td><td style="text-align: center">64</td></tr>
<tr><td style="text-align: center">16</td><td style="text-align: center">512</td></tr>
<tr><td style="text-align: center">8</td><td style="text-align: center">4096</td></tr>
<tr><td style="text-align: center">4</td><td style="text-align: center">32768</td></tr>
<tr><td style="text-align: center">2</td><td style="text-align: center">262144</td></tr>
<tr><td style="text-align: center">1</td><td style="text-align: center">Remaining chunk sizes</td></tr>
</tbody></table>
</div>
<h3 id="unsorted-bins"><a class="header" href="#unsorted-bins">Unsorted Bins</a></h3>
<p>There is a single unsorted bin. Chunks from small and large bins end up directly in this bin after they are freed. The point of the unsorted bin is to speed up allocations by serving a sort of cache. When <code>malloc</code> is invoked, it will first traverse this bin and see if it can immediately service the request. If not, it will move onto the small or large bins respectively.</p>
<h3 id="fast-bins"><a class="header" href="#fast-bins">Fast Bins</a></h3>
<p>Fast bins provide a further optimisation layer. Recently released small chunks are put in fast bins and are not initially merged with their neighbours. This allows for them to be repurposed forthwith, should a <code>malloc</code> request for that chunk size come very soon after the chunk's release. There are 10 fast bins, covering chunks of size 16, 24, 32, 40, 48, 56, 64, 72, 80, and 88 bytes plus chunk metadata.</p>
<p>Fast bins are implemented as singly linked lists and insertions and removals of entries in them are really fast. Periodically, the heap manager <em>consolidates</em> the heap - chunks in the fast bins are merged with the abutting chunks and inserted into the unsorted bin.</p>
<p>This consolidation occurs when a <code>malloc</code> request is issued for a size that is larger than a fast bin can serve (chunks over 512 bytes on 32-bit systems and over 1024 bytes on 64-bit systems), when freeing a chunk larger than 64KB or when <code>malloc_trim</code> or <code>mallopt</code> is invoked.</p>
<h3 id="tcache-bins"><a class="header" href="#tcache-bins">TCache Bins</a></h3>
<p>A new caching mechanism called <em>tcache</em> (thread local caching) was introduced in glibc version 2.26 back in 2017. </p>
<p>The tcache stores bins of fixed size small chunks as singly linked lists. Similarly to a fast bin, chunks in tcache bins aren't merged with adjoining chunks. By default, there are 64 tcache bins, each containing a maximum of 7 same-sized chunks. The possible chunk sizes range from 12 to 516 bytes on 32-bit systems and from 24 to 1032 bytes on 64-bit systems.</p>
<p>When a chunk is freed, the heap manager checks if the chunk fits into a tcache bin corresponding to that chunk size. If the tcache bin for this size is full or the chunk is simply too big to fit into a tcache bin, the heap manager obtains a lock on the arena and proceeds to comb through other bins in order to find a suitable one for the chunk.</p>
<p>When <code>malloc</code> needs to service a request, it first checks the tcache for a chunk of the requested size that is available and should such a chunk be found, <code>malloc</code> will return it without ever having to obtain a lock. If the chunk too big, <code>malloc</code> continues as before.</p>
<p>A slightly different strategy is employed if the requested chunk size does have a corresponding tcache bin, but that bin is simply full. In that case, <code>malloc</code> obtains a lock and promotes as many heap chunks of the requested size to tcache chunks, up to the tcache bin limit of 7. Subsequently, the last matching chunk is returned.</p>
<h2 id="malloc-and-free"><a class="header" href="#malloc-and-free"><code>malloc</code> and <code>free</code></a></h2>
<h3 id="allocation"><a class="header" href="#allocation">Allocation</a></h3>
<p>First, every allocation exists as a memory chunk which is aligned and contains metadata as well as the region the programmer wants. When a programmer requests memory from the heap, the heap manager first works out what chunk size the allocation request corresponds to, and then searches for the memory in the following order:</p>
<ol>
<li>If the size corresponds with a <em>tcache</em> bin and there is a <code>tcache</code> chunk available, return that immediately.</li>
<li>If the request is huge, allocate a chunk off-heap via <code>mmap.</code></li>
<li>Otherwise obtain the arena heap lock and then perform the following steps, in order:
<ol>
<li><strong>Try the <em>fastbin/smallbin</em> recycling strategy</strong>
<ul>
<li>If a corresponding fast bin exists, try and find a chunk from there (and also opportunistically prefill the tcache with entries from the fast bin).</li>
<li>Otherwise, if a corresponding small bin exists, allocate from there (opportunistically prefilling the tcache as we go).</li>
</ul>
</li>
<li><strong>Resolve all the deferred frees</strong>
-   Otherwise merge the entries in the fast bins and move their consolidated chunks to the unsorted bin.
-   Go through each entry in the unsorted bin. If it is suitable, return it. Otherwise, put the unsorted entry on its corresponding small/large bin as we go (possibly promoting small entries to the tcache).</li>
<li><strong>Default back to the basic recycling strategy</strong>
<ul>
<li>If the chunk size corresponds with a large bin, search the corresponding large bin now.</li>
</ul>
</li>
<li><strong>Create a new chunk from scratch</strong>
<ul>
<li>Otherwise, there are no chunks available, so try and get a chunk from the top of the heap.</li>
<li>If the top of the heap is not big enough, extend it using <code>sbrk</code>.</li>
<li>If the top of the heap can’t be extended because we ran into something else in the address space, create a discontinuous extension using <code>mmap</code> and allocate from there</li>
</ul>
</li>
<li><strong>If all else fails, return <code>NULL</code>.</strong></li>
</ol>
</li>
</ol>
<h3 id="deallocation"><a class="header" href="#deallocation">Deallocation</a></h3>
<ol>
<li>If the pointer is <code>NULL</code>, do nothing.</li>
<li>Otherwise, convert the pointer back to a chunk by subtracting the size of the chunk metadata.</li>
<li>Perform a few sanity checks on the chunk, and abort if the sanity checks fail.</li>
<li>If the chunk fits into a tcache bin, store it there.</li>
<li>If the chunk has the <code>M</code> bit set, give it back to the operating system via <code>munmap</code>.</li>
<li>Otherwise we obtain the arena heap lock and then:
<ol>
<li>If the chunk fits into a fastbin, put it on the corresponding fastbin.</li>
<li>If the chunk size is greater than 64KB, consolidate the fastbins immediately and put the resulting merged chunks on the unsorted bin.</li>
<li>Merge the chunk backwards and forwards with neighboring freed chunks in the small, large, and unsorted bins.</li>
<li>If the resulting chunk lies at the top of the heap, merge it into the top chunk.</li>
<li>Otherwise store it in the <code>unsorted bin</code>. </li>
</ol>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../Reverse Engineering/Program Anatomy/Instructions.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../Reverse Engineering/Program Anatomy/Registers.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../Reverse Engineering/Program Anatomy/Instructions.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../Reverse Engineering/Program Anatomy/Registers.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
